<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>webrtc demo</title>
    <style>
      html,
      body {
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .container {
        position: relative;
        width: 680px;
        height: 600px;
      }
      .shareVideo {
        width: 680px;
        height: 600px;
      }
      .localVideo {
        position: absolute;
        bottom: 100px;
        right: 0;
        width: 100px;
        height: 100px;
      }
    </style>
  </head>
  <body>
    <div class="container" id="container">
      <video class="shareVideo" id="shareVideo" autoplay playsinline muted></video>
      <video class="localVideo" id="localVideo" autoplay playsinline muted></video>
    </div>
    <button onclick="handlePhoto()">æ‹ç…§</button>
    <img id="localPhoto" style="width: 200px; height: 150px" />

    <script>
      window.onload = function () {
        getStream()
      }
      // è·å–æœ¬åœ°éŸ³è§†é¢‘æµ
      async function getStream() {
        // è·å–åª’ä½“æµ
        const localStream = await navigator.mediaDevices.getUserMedia({
          audio: true,
          video: {
            width: 680,
            height: 600,
          },
        })
        // è·å–å±å¹•å…±äº«çš„åª’ä½“æµ
        const shareStream = await navigator.mediaDevices.getDisplayMedia({
          audio: true,
          video: true,
        })
        // å°†åª’ä½“æµè®¾ç½®åˆ° video æ ‡ç­¾ä¸Šæ’­æ”¾
        playLocalStream(localStream)
        playShareStream(shareStream)
      }

      // æ’­æ”¾æœ¬åœ°è§†é¢‘æµ
      function playLocalStream(stream) {
        const videoEl = document.getElementById("localVideo")
        videoEl.srcObject = stream
      }

      // æ’­æ”¾å…±äº«è§†é¢‘æµ
      function playShareStream(stream) {
        const videoEl = document.getElementById("shareVideo")
        videoEl.srcObject = stream
      }

      // æ‹ç…§
      function handlePhoto() {
        const videoEl = document.getElementById("localVideo")
        const photoEl = document.getElementById("localPhoto")
        const canvas = document.createElement("canvas")
        canvas.width = videoEl.videoWidth
        canvas.height = videoEl.videoHeight
        const ctx = canvas.getContext("2d")
        ctx.drawImage(videoEl, 0, 0, canvas.width, canvas.height)
        // è½¬ base64
        console.log("ğŸš€ğŸš€ğŸš€ / img", canvas.toDataURL("image/png"))
        photoEl.src = canvas.toDataURL("image/png")
      }
    </script>
  </body>
</html>
